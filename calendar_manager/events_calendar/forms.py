from django.db.models import fields
from django.forms import ModelForm, DateInput, widgets

from events_calendar.models import Event, EventMember, Group, GroupMember, GroupEvent
from django import forms


class EventForm(ModelForm):
    class Meta:
        model = Event
        fields = ["title", "description", "start_time", "end_time"]
        # datetime-local is a HTML5 input type
        widgets = {
            "title": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Enter event title"}
            ),
            "description": forms.Textarea(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter event description",
                }
            ),
            "start_time": DateInput(
                attrs={"type": "datetime-local", "class": "form-control"},
                format="%Y-%m-%dT%H:%M",
            ),
            "end_time": DateInput(
                attrs={"type": "datetime-local", "class": "form-control"},
                format="%Y-%m-%dT%H:%M",
            ),
        }
        exclude = ["user"]
    
    def clean(self):
        cleaned_data = super().clean()
        start_time = cleaned_data.get("start_time")
        end_time = cleaned_data.get("end_time")

        # if start_time >= end_time :
        #     raise forms.ValidationError('Invalid Time input')

        return cleaned_data

    def __init__(self, *args, **kwargs):
        super(EventForm, self).__init__(*args, **kwargs)
        # input_formats to parse HTML5 datetime-local input to datetime field
        self.fields["start_time"].input_formats = ("%Y-%m-%dT%H:%M",)
        self.fields["end_time"].input_formats = ("%Y-%m-%dT%H:%M",)
    

class AddMemberForm(forms.ModelForm):
    class Meta:
        model = EventMember
        fields = ["user"]

class AddGroupForm(forms.ModelForm):
    class Meta:
        model = Group
        fields = ["name"]

class AddGroupMemberForm(forms.ModelForm):
    class Meta:
        model = GroupMember
        fields = ["user"]

class AddGroupEvent(forms.ModelForm):
    class Meta:
        model = GroupEvent
        fields = ["title", "description", "start_time", "end_time", "group"]
        widgets = {
            "title": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Enter event title"}
            ),
            "description": forms.Textarea(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter event description",
                }
            ),
            "start_time": DateInput(
                attrs={"type": "datetime-local", "class": "form-control"},
                format="%Y-%m-%dT%H:%M",
            ),
            "end_time": DateInput(
                attrs={"type": "datetime-local", "class": "form-control"},
                format="%Y-%m-%dT%H:%M",
            ),
        }
        # exclude = ["group"]
    
    def clean(self):
        cleaned_data = super().clean()
        start_time = cleaned_data.get("start_time")
        end_time = cleaned_data.get("end_time")

        return cleaned_data

    def __init__(self, *args, **kwargs):
        super(AddGroupEvent, self).__init__(*args, **kwargs)
        # input_formats to parse HTML5 datetime-local input to datetime field
        self.fields["start_time"].input_formats = ("%Y-%m-%dT%H:%M",)
        self.fields["end_time"].input_formats = ("%Y-%m-%dT%H:%M",)

class Recommendform(forms.Form):
    start_time = forms.DateField(widget=forms.DateInput(
        attrs={"type": "datetime-local", "class": "form-control"},
        format="%Y-%m-%d %H:%M",)
    )
    end_time = forms.DateField(widget=forms.DateInput(
        attrs={"type": "datetime-local", "class": "form-control"},
        format="%Y-%m-%d %H:%M:%S",
    ))

    def clean(self):
        cleaned_data = super().clean()
        start_time = cleaned_data.get("start_time")
        end_time = cleaned_data.get("end_time")

        return cleaned_data